{% extends 'navbar.html' %}

{% block content%}

<div class="p-4 md:p-6 lg:p-8">
    <!-- Analytics and Sales Chart Section -->
    <div class="grid grid-cols-1 xl:grid-cols-2 gap-4 mb-4">
        <div>
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-3">


                <form action="{% url 'dashboard_home' %}" method="get" id="filter-form">

                    <!-- hidden field to store filter chosen -->
                    <input type="hidden" name="filter" id="filterType" value="{{ filter_type }}">

                    <div class="flex flex-wrap gap-2">

                        <!-- TODAY -->
                        <button type="submit" onclick="setFilter('today')" name="btn" class="px-4 py-2 text-sm rounded-full font-medium
                        {% if filter_type == 'today' %} bg-green-500 text-white {% else %}
                        bg-gray-100 text-gray-700 hover:bg-gray-200 {% endif %}">
                            Today </button>

                        <!-- WEEKLY -->
                        <button type="submit" onclick="setFilter('weekly')" name="btn" class="px-4 py-2 text-sm rounded-full font-medium
                        {% if filter_type == 'weekly' %} bg-green-500 text-white {% else %}
                        bg-gray-100 text-gray-700 hover:bg-gray-200 {% endif %}">
                            Weekly </button>

                        <!-- MONTHLY -->
                        <button type="submit" onclick="setFilter('monthly')" name="btn" class="px-4 py-2 text-sm rounded-full font-medium
                            {% if filter_type == 'monthly' %} bg-green-500 text-white {% else %}
                            bg-gray-100 text-gray-700 hover:bg-gray-200 {% endif %}">
                            Monthly </button>

                        <!-- YEARLY -->
                        <button type="submit" onclick="setFilter('yearly')" name="btn" class="px-4 py-2 text-sm rounded-full font-medium
                            {% if filter_type == 'yearly' %} bg-green-500 text-white {% else %}
                            bg-gray-100 text-gray-700 hover:bg-gray-200 {% endif %}">
                            Yearly </button>

                        <!-- CUSTOM RANGE BUTTON -->
                        <button type="button" id="customBtn" onclick="enableCustom()" class="px-4 py-2 text-sm rounded-full font-medium
                        {% if filter_type == 'custom' %} bg-green-500 text-white {% else %}
                        bg-gray-100 text-gray-700 hover:bg-gray-200 {% endif %}">
                            Custom Range </button>

                        <!-- DATE FIELDS -->
                        <div id="dateFields"
                            class="flex items-center gap-2 mt-2 {% if filter_type != 'custom' %} hidden {% endif %}">
                            <input type="date" name="start" id="startDate" value="{{ start_date }}"
                                class="px-3 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-green-400 focus:border-green-500 text-sm">
                            <input type="date" name="end" id="endDate" value="{{ end_date }}"
                                class="px-3 py-2 border border-gray-200 rounded-lg shadow-sm focus:ring-green-400 focus:border-green-500 text-sm">
                        </div>

                        <!-- SUBMIT FOR CUSTOM -->
                        <button type="submit" id="customSubmit" class="px-4 py-2 mt-2 rounded-full text-sm font-medium bg-green-500 text-white
                        {% if filter_type != 'custom' %} hidden {% endif %}">
                            Apply
                        </button>

                    </div>
                </form>

                
            </div>
        </div>
    </div>
    <!-- Stats Cards Row -->
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 md:gap-6 mb-6">
        <!-- Sales Card -->
        <div class="bg-white rounded-xl shadow-sm p-6 flex items-center space-x-4">
            <div class="bg-green-100 rounded-full p-4">
                <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
            </div>
            <div>
                <div class="text-3xl font-bold text-gray-800">{{filtered_sales}}</div>
                <div class="text-sm text-gray-500">Gross Sales</div>
            </div>
        </div>

        <!-- Customers Card -->
        <div class="bg-white rounded-xl shadow-sm p-6 flex items-center space-x-4">
            <div class="bg-blue-100 rounded-full p-4">
                <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div>
                <div class="text-3xl font-bold text-gray-800">{{filtered_count}}</div>
                <div class="text-sm text-gray-500">Orders</div>
            </div>
        </div>

        <!-- Products Card -->
        <div class="bg-white rounded-xl shadow-sm p-6 flex items-center space-x-4">
            <div class="bg-yellow-100 rounded-full p-4">
                <svg class="w-6 h-6 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                </svg>
            </div>
            <div>
                <div class="text-3xl font-bold text-gray-800">{{filtered_discount}}</div>
                <div class="text-sm text-gray-500">Total Discount</div>
            </div>
        </div>

        <!-- Revenue Card -->
        <div class="bg-white rounded-xl shadow-sm p-6 flex items-center space-x-4">
            <div class="bg-green-100 rounded-full p-4">
                <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
            </div>
            <div>
                <div class="text-3xl font-bold text-gray-800">{{filtered_net_sales}}</div>
                <div class="text-sm text-gray-500">Revenue</div>
            </div>
        </div>
    </div>


    <!-- Pie Charts Section -->
    <div>
        <!-- Most Selling Products Pie Chart -->
        <div class="bg-white rounded-xl shadow-sm p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-6">Top Selling Products</h3>

            <div class="flex flex-col md:flex-row items-center justify-center gap-8 mb-6">

                <!-- Pie Chart SVG -->
                <div class="relative w-48 h-48 flex-shrink-0">
                    <svg viewBox="0 0 200 200" class="transform -rotate-90">

                        {% for item in product_show %}
                        <circle cx="100" cy="100" r="80" fill="transparent" stroke="{{ item.color }}" stroke-width="60"
                            stroke-dasharray="{{ item.dasharray }} 502" stroke-dashoffset="{{ item.dashoffset }}" />
                        {% endfor %}

                    </svg>

                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-800">100%</div>
                            <div class="text-xs text-gray-500">Total</div>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="space-y-3">
                    {% for item in product_show %}
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 bg-blue-500 rounded" style="background: {{ item.color }}"></div>
                        <span class="text-sm text-gray-700">{{ item.name }}</span>
                        <span class="text-sm font-semibold text-gray-800 ml-auto">{{ item.percentage }}%</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Product Details Table -->
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-t border-b border-gray-200 bg-gray-50">
                            <th class="text-left py-3 px-4 font-semibold text-gray-600">Product</th>
                            <th class="text-center py-3 px-4 font-semibold text-gray-600">Quantity Sold</th>
                            <th class="text-right py-3 px-4 font-semibold text-gray-600">Revenue</th>
                            <th class="text-right py-3 px-4 font-semibold text-gray-600">Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in product_show %}
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="py-3 px-4">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 rounded" style="background-color: {{ item.color }};"></div>
                                    <span class="text-gray-800 font-medium">{{ item.name }}</span>
                                </div>
                            </td>
                            <td class="py-3 px-4 text-center text-gray-700">{{item.quantity}}</td>
                            <td class="py-3 px-4 text-right text-gray-800 font-medium"> Rs. {{item.revenue}} </td>
                            <td class="py-3 px-4 text-right text-gray-700">{{ item.percentage }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="mt-6">
        <!-- Most Selling Categories Pie Chart -->
        <div class="bg-white rounded-xl shadow-sm p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-6">Top Selling Categories</h3>

            <div class="flex flex-col md:flex-row items-center justify-center gap-8 mb-6">
                <!-- Pie Chart SVG -->
                <div class="relative w-48 h-48 flex-shrink-0">
                    <svg viewBox="0 0 200 200" class="transform -rotate-90">
                        {% for item in category_show %}
                        <circle cx="100" cy="100" r="80" fill="transparent" stroke="{{ item.color }}" stroke-width="60"
                            stroke-dasharray="{{ item.dasharray }} 502" stroke-dashoffset="{{ item.dashoffset }}" />
                        {% endfor %}

                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-800">100%</div>
                            <div class="text-xs text-gray-500">Total</div>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="space-y-3">
                    {% for item in category_show %}
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 bg-blue-500 rounded" style="background: {{ item.color }}"></div>
                        <span class="text-sm text-gray-700">{{ item.name }}</span>
                        <span class="text-sm font-semibold text-gray-800 ml-auto">{{ item.percentage }}%</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Category Details Table -->
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-t border-b border-gray-200 bg-gray-50">
                            <th class="text-left py-3 px-4 font-semibold text-gray-600">Category</th>
                            <th class="text-center py-3 px-4 font-semibold text-gray-600">Quantity Sold</th>
                            <th class="text-right py-3 px-4 font-semibold text-gray-600">Revenue</th>
                            <th class="text-right py-3 px-4 font-semibold text-gray-600">Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in category_show %}
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="py-3 px-4">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 rounded" style="background-color: {{ item.color }};"></div>
                                    <span class="text-gray-800 font-medium">{{ item.name }}</span>
                                </div>
                            </td>
                            <td class="py-3 px-4 text-center text-gray-700">{{item.quantity}}</td>
                            <td class="py-3 px-4 text-right text-gray-800 font-medium"> Rs. {{item.revenue}} </td>
                            <td class="py-3 px-4 text-right text-gray-700">{{ item.percentage }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>



    <!-- Orders Table -->
    <div class="bg-white rounded-xl shadow-sm p-6 mt-6">
        <h3 class="text-xl font-semibold text-gray-800 mb-6">Recent Orders</h3>

        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-gray-200">
                        <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Customer</th>
                        <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Order ID</th>
                        <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Date</th>

                        <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Amount</th>
                        <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Payment Method</th>
                        <th class="text-left py-3 px-4 text-sm font-semibold text-gray-600">Order Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for o in orders %}
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="py-4 px-4">
                            <div class="flex items-center space-x-3">

                                <span class="text-sm text-gray-800 font-medium">{{o.user.firstname}}</span>
                            </div>
                        </td>
                        <td class="py-4 px-4 text-sm text-gray-700">{{o.orderID}}</td>
                        <td class="py-4 px-4 text-sm text-gray-700">{{o.created_at}}</td>
                        <td class="py-4 px-4 text-sm font-medium text-gray-800">{{o.total_price}}</td>
                        <td class="py-4 px-4">
                            <div class="flex items-center space-x-2">

                                <span class="text-sm text-green-600 font-medium">{{o.payment_method}}</span>
                            </div>
                        </td>
                        <td class="py-4 px-4">
                            <span
                                class="px-3 py-1 text-xs font-medium text-green-700 bg-green-100 rounded-full">{{o.orderitem.all.0.status}}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>


{% endblock %}